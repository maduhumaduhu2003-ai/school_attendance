<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login | {{ school_settings.school_name|default:"School Attendance System" }}</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
:root {
    --primary-color: #4f46e5;
    --primary-dark: #4338ca;
    --secondary-color: #10b981;
    --accent-color: #f59e0b;
    --card-color: rgba(255,255,255,0.85);
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --border-color: #e5e7eb;
    --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.1);
    --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
}

/* Reset */
* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background: #1e293b;
    position: relative;
    overflow: hidden;
}

body::before {
    content: "";
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: url("{% if school_settings.logo %}{{ school_settings.logo.url }}{% else %}/static/images/logo.png{% endif %}") center center/cover no-repeat;
    z-index:-2;
    filter: brightness(0.25);
}

body::after {
    content:"";
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.15);
    z-index:-1;
}

/* Animated bubbles */
.bg-bubble-1, .bg-bubble-2, .bg-bubble-3 {
    position: fixed;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
    z-index: -1;
    animation: float 20s infinite ease-in-out;
}
.bg-bubble-1 { width: 300px; height: 300px; top:-150px; right:-150px; animation-delay:0s; }
.bg-bubble-2 { width: 200px; height: 200px; bottom:-100px; left:-100px; animation-delay:5s; }
.bg-bubble-3 { width: 150px; height: 150px; top:50%; left:-75px; animation-delay:10s; }

@keyframes float {
    0%,100% { transform: translateY(0) rotate(0deg); }
    33% { transform: translateY(-30px) rotate(120deg); }
    66% { transform: translateY(30px) rotate(240deg); }
}

/* Login container */
.login-container { width:100%; max-width:360px; padding: 0 15px; animation:slideUp 0.6s ease-out; }

/* Login card */
.login-card {
    background: var(--card-color);
    border-radius:20px;
    box-shadow: var(--shadow-lg);
    overflow:hidden;
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
}

/* Card header */
.card-header {
    padding: 1.5rem 1.5rem 1rem;
    text-align:center;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(5px);
    border-bottom: 1px solid var(--border-color);
}
.school-logo {
    width:70px;
    height:70px;
    border-radius:50%;
    object-fit:cover;
    margin:0 auto 0.75rem;
    padding:6px;
    background:white;
    box-shadow:0 3px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}
.school-logo:hover { transform: scale(1.05); }
.school-name { color: var(--primary-color); font-size:1.4rem; font-weight:700; margin-bottom:0.25rem; }
.card-subtitle { color: var(--text-secondary); font-size:0.85rem; font-weight:500; }

/* Card body */
.card-body { padding:1.25rem 1.5rem 1.5rem; }
.form-label { color: var(--text-primary); font-weight:600; font-size:0.9rem; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; }
.form-label i { color: var(--primary-color); }
.form-control {
    padding:0.75rem 1rem;
    border:2px solid var(--border-color);
    border-radius:10px;
    font-size:1rem;
    transition: all 0.3s ease;
    background:white;
}
.form-control:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); transform: translateY(-1px); }

.input-group { position: relative; }
.password-toggle { position:absolute; right:12px; top:50%; transform:translateY(-50%); color: var(--text-secondary); cursor:pointer; background:none; border:none; padding:0; z-index:10; }
.password-toggle:hover { color: var(--primary-color); }

.login-btn {
    background: var(--gradient-primary);
    border:none;
    border-radius:10px;
    padding:0.85rem;
    font-weight:600;
    font-size:1rem;
    color:white;
    transition: all 0.3s ease;
}
.login-btn:hover { transform: translateY(-1px); box-shadow:0 6px 15px rgba(79,70,229,0.3); }
.login-btn:active { transform: translateY(0); }

/* Card footer */
.card-footer { padding:1rem 1.5rem; text-align:center; background: rgba(255,255,255,0.7); backdrop-filter: blur(5px); color: var(--text-secondary); font-size:0.8rem; border-top:1px solid var(--border-color); }

@keyframes slideUp { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:translateY(0); } }

/* ================= RESPONSIVE IMPROVEMENTS ================= */
@media(max-width:480px) {
    .login-container { max-width:95%; }
    .card-header { padding:1.25rem 1rem 0.75rem; }
    .card-body { padding:1.25rem 1rem 1rem; }
    .card-footer { padding:0.75rem 1rem; font-size:0.75rem; }
    .school-logo { width:60px; height:60px; }
    .school-name { font-size:1.2rem; }
    .form-control { font-size:0.85rem; padding:0.65rem 0.9rem; }
    .login-btn { font-size:0.9rem; padding:0.7rem; }
    .password-toggle { right:8px; }
}
@media(max-width:360px){
    .login-btn { font-size:0.85rem; padding:0.65rem; }
    .school-name { font-size:1.1rem; }
    .card-body { padding:1rem; }
}

/* Bubbles smaller screens */
@media(max-width:480px){
    .bg-bubble-1 { width:200px; height:200px; top:-100px; right:-100px; }
    .bg-bubble-2 { width:150px; height:150px; bottom:-75px; left:-75px; }
    .bg-bubble-3 { width:100px; height:100px; top:50%; left:-50px; }
}
</style>
</head>
<body>

<!-- Animated bubbles -->
<div class="bg-bubble-1"></div>
<div class="bg-bubble-2"></div>
<div class="bg-bubble-3"></div>

<div class="login-container">
    <div class="login-card">
        <!-- Card Header -->
        <div class="card-header">
            {% if school_settings.logo %}
                <img src="{{ school_settings.logo.url }}" alt="School Logo" class="school-logo">
            {% else %}
                <img src="/static/images/logo.png" alt="Default Logo" class="school-logo">
            {% endif %}
            <h1 class="school-name">{{ school_settings.school_name|default:"School Attendance System" }}</h1>
            <p class="card-subtitle">Secure Login Portal</p>
        </div>

        <!-- Card Body -->
        <div class="card-body">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <form method="post" id="loginForm">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-person-fill"></i> Username</label>
                    <input type="text" name="username" class="form-control" placeholder="Enter your username" required autofocus>
                </div>

                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-key-fill"></i> Password</label>
                    <div class="input-group">
                        <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required>
                        <button type="button" class="password-toggle" onclick="togglePassword()"><i class="bi bi-eye"></i></button>
                    </div>
                </div>

                <div class="d-grid mb-3">
                    <button type="submit" class="btn login-btn" id="loginButton">Login</button>
                </div>

                <div class="text-center mb-2">
                    <a href="{% url 'forgot_password' %}" class="forgot-link"><i class="bi bi-shield-lock"></i> Forgot password?</a>
                </div>

                <!-- Register Admin Link -->
                {% if not admin_exists %}
                    <div class="text-center mt-3">
                        <a href="{% url 'register_admin' %}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-person-plus-fill"></i> Register Admin
                        </a>
                    </div>
                {% endif %}
            </form>
        </div>

        <div class="card-footer">
            &copy; {{ year|default:"2025" }} {{ school_settings.school_name|default:"School Attendance System" }}<br>
            <small class="text-muted">All rights reserved</small>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function togglePassword() {
    const passwordInput = document.getElementById('password');
    const icon = passwordInput.nextElementSibling.querySelector('i');
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.replace('bi-eye','bi-eye-slash');
    } else {
        passwordInput.type = 'password';
        icon.classList.replace('bi-eye-slash','bi-eye');
    }
}
</script>
</body>
</html>
